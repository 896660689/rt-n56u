diff -urNw e2fsprogs-1.46.5.ref/lib/ext2fs/extent.c e2fsprogs-1.46.5/lib/ext2fs/extent.c
--- e2fsprogs-1.46.5.ref/lib/ext2fs/extent.c	2021-12-30 13:54:33.000000000 +0800
+++ e2fsprogs-1.46.5/lib/ext2fs/extent.c	2023-01-03 01:59:34.339572730 +0800
@@ -495,6 +495,10 @@
 			ext2fs_le16_to_cpu(eh->eh_entries);
 		newpath->max_entries = ext2fs_le16_to_cpu(eh->eh_max);
 
+		/* Make sure there is at least one extent present */
+		if (newpath->left <= 0)
+			return EXT2_ET_EXTENT_NO_DOWN;
+
 		if (path->left > 0) {
 			ix++;
 			newpath->end_blk = ext2fs_le32_to_cpu(ix->ei_block);
@@ -1630,6 +1634,10 @@
 
 	cp = path->curr;
 
+	/* Sanity check before memmove() */
+	if (path->left < 0)
+		return EXT2_ET_EXTENT_LEAF_BAD;
+
 	if (path->left) {
 		memmove(cp, cp + sizeof(struct ext3_extent_idx),
 			path->left * sizeof(struct ext3_extent_idx));
diff -urNw e2fsprogs-1.46.5.ref/misc/e4defrag.c e2fsprogs-1.46.5/misc/e4defrag.c
--- e2fsprogs-1.46.5.ref/misc/e4defrag.c	2021-12-30 13:54:33.000000000 +0800
+++ e2fsprogs-1.46.5/misc/e4defrag.c	2023-01-03 01:47:27.848531154 +0800
@@ -195,9 +195,11 @@
 #error posix_fadvise not available!
 #endif
 
+#if 0
 #ifndef HAVE_FALLOCATE64
 #error fallocate64 not available!
 #endif /* ! HAVE_FALLOCATE64 */
+#endif
 
 /*
  * get_mount_point() -	Get device's mount point.
@@ -1568,7 +1570,7 @@
 	/* Allocate space for donor inode */
 	orig_group_tmp = orig_group_head;
 	do {
-		ret = fallocate64(donor_fd, 0,
+		ret = posix_fallocate64(donor_fd,
 		  (ext2_loff_t)orig_group_tmp->start->data.logical * block_size,
 		  (ext2_loff_t)orig_group_tmp->len * block_size);
 		if (ret < 0) {
diff -urNw e2fsprogs-1.46.5.ref/misc/mke2fs.conf.in e2fsprogs-1.46.5/misc/mke2fs.conf.in
--- e2fsprogs-1.46.5.ref/misc/mke2fs.conf.in	2021-12-30 13:54:33.000000000 +0800
+++ e2fsprogs-1.46.5/misc/mke2fs.conf.in	2023-01-03 01:49:50.691912750 +0800
@@ -1,6 +1,6 @@
 [defaults]
-	base_features = sparse_super,large_file,filetype,resize_inode,dir_index,ext_attr
-	default_mntopts = acl,user_xattr
+	base_features = sparse_super,filetype,resize_inode,dir_index,ext_attr
+	default_mntopts = user_xattr
 	enable_periodic_fsck = 0
 	blocksize = 4096
 	inode_size = 256
@@ -11,7 +11,8 @@
 		features = has_journal
 	}
 	ext4 = {
-		features = has_journal,extent,huge_file,flex_bg,metadata_csum,64bit,dir_nlink,extra_isize
+		features = has_journal,extent,huge_file,flex_bg,uninit_bg,dir_nlink,extra_isize
+		auto_64-bit_support = 1
 	}
 	small = {
 		blocksize = 1024
